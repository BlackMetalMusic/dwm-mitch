diff -Narup dmenu-3.4/config.h 00_dmenu-3.4_history/config.h
--- dmenu-3.4/config.h	2007-10-25 20:26:14.000000000 +0200
+++ 00_dmenu-3.4_history/config.h	2007-10-28 19:40:46.000000000 +0100
@@ -8,3 +8,4 @@
 #define SELFGCOLOR              "#ffffff"
 /* next macro defines the space between menu items */
 #define SPACE			30 /* px */
+#define HIST_SIZE       	20
diff -Narup dmenu-3.4/dmenu.c 00_dmenu-3.4_history/dmenu.c
--- dmenu-3.4/dmenu.c	2007-10-25 20:26:14.000000000 +0200
+++ 00_dmenu-3.4_history/dmenu.c	2007-10-28 19:40:46.000000000 +0100
@@ -73,6 +73,9 @@ char *prompt = NULL;
 char *selbg = SELBGCOLOR;
 char *selfg = SELFGCOLOR;
 char text[4096];
+static char hist[HIST_SIZE][1024];
+static char *histfile = NULL;
+static int hcnt = 0;
 int screen;
 int ret = 0;
 unsigned int cmdw = 0;
@@ -152,6 +155,46 @@ cleanup(void) {
 	XUngrabKeyboard(dpy, CurrentTime);
 }
 
+int
+writehistory(char *command) {
+    int i = 0, j = hcnt;
+    FILE *f;
+
+    if(!histfile)
+        return 0;
+
+    if( (f = fopen(histfile, "w")) ) {
+        fputs(command, f); fputc('\n', f);
+        for(; i<HIST_SIZE && i<j; i++) {
+            if(strcmp(command, hist[i]) != 0) 
+                fputs(hist[i], f); fputc('\n', f);
+        }
+        fclose(f);
+        return 1;
+    }
+
+    return 0;
+}
+
+static int
+readhistory (void) {
+    char buf[1024];
+    FILE *f;
+
+
+    if(!histfile)
+        return 0;
+
+    if( (f = fopen(histfile, "r+")) ) {
+        while(fgets(buf, sizeof buf, f))  
+            strncpy(hist[hcnt++], buf, (strlen(buf) <= 1024) ? strlen(buf): 1024 );
+        fclose(f);
+    }
+
+    return hcnt;
+}
+
+
 void
 drawmenu(void) {
 	Item *i;
@@ -474,6 +517,7 @@ kpress(XKeyEvent * e) {
 			fprintf(stdout, "%s", sel->text);
 		else if(text)
 			fprintf(stdout, "%s", text);
+                writehistory( (sel == NULL) ? text : sel->text);
 		fflush(stdout);
 		running = False;
 		break;
@@ -527,8 +571,32 @@ readstdin(void) {
 	char *p, buf[1024];
 	unsigned int len = 0, max = 0;
 	Item *i, *new;
+	int k;
 
 	i = 0;
+	if( readhistory() )  {
+		for(k=0; k<hcnt; k++) {
+			len = strlen(hist[k]);
+			if (hist[k][len - 1] == '\n')
+				hist[k][len - 1] = 0;
+			p = estrdup(hist[k]);
+			if(max < len) {
+				maxname = p;
+				max = len;
+			}
+			new = emalloc(sizeof(Item));
+			new->next = new->left = new->right = NULL;
+			new->text = p;
+			if(!i)
+				allitems = new;
+			else 
+				i->next = new;
+			i = new;
+		}
+	}
+	
+	
+	len=0; max=0;    
 	while(fgets(buf, sizeof buf, stdin)) {
 		len = strlen(buf);
 		if (buf[len - 1] == '\n')
@@ -699,6 +767,9 @@ main(int argc, char *argv[]) {
 		else if(!strcmp(argv[i], "-sf")) {
 			if(++i < argc) selfg = argv[i];
 		}
+		else if(!strcmp(argv[i], "-hist")) {
+			if(++i < argc) histfile = argv[i];
+		}
 		else if(!strcmp(argv[i], "-v"))
 			eprint("dmenu-"VERSION", © 2006-2007 Anselm R. Garbe, Sander van Dijk, Michał Janeczek\n");
 		else
